import{r as l,b as D,z as j,j as e,B as E,M as S,e as _,u as q,k as G}from"./index-Dza2ow_d.js";import{D as z}from"./DeviceMap-Dj2W3kp8.js";import{X as B}from"./x-BPQG-vSi.js";import{C as k}from"./calendar-CDwTpDyp.js";import{R as $,G as F}from"./route-vEfv4Ayk.js";import{D as A}from"./download-CYelR1NA.js";import{C as T}from"./clock-Bia-aWg3.js";import{f as P}from"./index-CipiYhTN.js";import{S as U}from"./smartphone-BueILheT.js";function H({device:i,onClose:R}){var s,n;const[o,I]=l.useState("summary"),[h,O]=l.useState("today"),[p,f]=l.useState(""),[x,N]=l.useState(""),[d,v]=l.useState(!1),[a,C]=l.useState({summary:null,positions:[]});l.useEffect(()=>{L()},[h,p,x]);const g=()=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate());switch(h){case"today":return{from:r.toISOString(),to:t.toISOString()};case"7days":const c=new Date(r);return c.setDate(c.getDate()-7),{from:c.toISOString(),to:t.toISOString()};case"30days":const u=new Date(r);return u.setDate(u.getDate()-30),{from:u.toISOString(),to:t.toISOString()};case"custom":return{from:p?new Date(p).toISOString():r.toISOString(),to:x?new Date(x).toISOString():t.toISOString()};default:return{from:r.toISOString(),to:t.toISOString()}}},L=async()=>{if(i.id){v(!0);try{const{from:t,to:r}=g(),[c,u]=await Promise.all([D.get(`/admin/devices/${i.id}/reports`,{params:{from:t,to:r}}),D.get(`/admin/devices/${i.id}/positions`,{params:{from:t,to:r,limit:1e3}})]);C({summary:c.data.summary,positions:u.data.positions||[]})}catch(t){console.error("Error fetching reports:",t),j.error("Failed to load device reports")}finally{v(!1)}}},b=t=>{const r=t==="summary"?a.summary:a.positions,c=`${i.name}_${t}_${P(new Date,"yyyy-MM-dd")}.json`,u=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),M=URL.createObjectURL(u),y=document.createElement("a");y.href=M,y.download=c,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(M),j.success(`${t} data exported successfully`)},w=t=>{const r=Math.floor(t/60),c=Math.round(t%60);return r>0?`${r}h ${c}m`:`${c}m`},m=a.positions.map(t=>({latitude:t.latitude,longitude:t.longitude,speed:t.speed,timestamp:t.fixTime}));return console.log("Route data:",m),console.log("Report data positions:",a.positions),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Device Reports"}),e.jsxs("p",{className:"text-gray-600",children:[i.name," (",i.uniqueId,")"]})]}),e.jsx("button",{onClick:R,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(B,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Date Range:"})]}),e.jsx("div",{className:"flex space-x-2",children:[{value:"today",label:"Today"},{value:"7days",label:"7 Days"},{value:"30days",label:"30 Days"},{value:"custom",label:"Custom"}].map(t=>e.jsx("button",{onClick:()=>O(t.value),className:`px-3 py-1 text-sm rounded-lg transition-colors ${h===t.value?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-100"}`,children:t.label},t.value))}),h==="custom"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"datetime-local",value:p,onChange:t=>f(t.target.value),className:"px-2 py-1 text-sm border border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"datetime-local",value:x,onChange:t=>N(t.target.value),className:"px-2 py-1 text-sm border border-gray-300 rounded"})]})]})}),e.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"summary",label:"Summary",icon:E},{id:"route",label:"Route",icon:$},{id:"positions",label:"Positions",icon:S}].map(t=>{const r=t.icon;return e.jsxs("button",{onClick:()=>I(t.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium transition-colors ${o===t.id?"border-b-2 border-primary-500 text-primary-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:t.label})]},t.id)})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(_,{})}):e.jsxs(e.Fragment,{children:[o==="summary"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Report Summary"}),e.jsxs("button",{onClick:()=>b("summary"),className:"btn-secondary flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]}),a.summary?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Distance"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[a.summary.totalDistance.toFixed(2)," km"]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-success-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max Speed"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[Math.round(a.summary.maxSpeed)," km/h"]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-warning-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Speed"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[Math.round(a.summary.averageSpeed)," km/h"]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Time"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:w(a.summary.totalTime)})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Moving Time"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:w(a.summary.movingTime)})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Positions"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:a.summary.positionCount})]})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No data available for the selected period"})})]}),o==="route"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Route Visualization"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[m.length," position points"]})]}),m.length>0?e.jsx("div",{className:"h-96 w-full",children:e.jsx(z,{devices:[{id:i.id,name:i.name,uniqueId:i.uniqueId,latitude:((s=m[0])==null?void 0:s.latitude)||null,longitude:((n=m[0])==null?void 0:n.longitude)||null,speed:null,course:null,lastUpdate:null,isOnline:!1}],routeData:m,showRoute:!0})}):e.jsx("div",{className:"flex items-center justify-center h-96 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No route data available"})]})})]}),o==="positions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Position History"}),e.jsxs("button",{onClick:()=>b("positions"),className:"btn-secondary flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]}),a.positions.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Time"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Latitude"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Longitude"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Speed"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Course"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Altitude"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a.positions.slice(0,100).map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:P(new Date(t.fixTime),"MMM dd, HH:mm:ss")}),e.jsx("td",{className:"px-4 py-2 font-mono",children:t.latitude.toFixed(6)}),e.jsx("td",{className:"px-4 py-2 font-mono",children:t.longitude.toFixed(6)}),e.jsxs("td",{className:"px-4 py-2",children:[Math.round(t.speed)," km/h"]}),e.jsxs("td",{className:"px-4 py-2",children:[Math.round(t.course),"Â°"]}),e.jsxs("td",{className:"px-4 py-2",children:[Math.round(t.altitude),"m"]})]},r))})]}),a.positions.length>100&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Showing first 100 positions. Export for complete data."})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No position data available"})})]})]})})]})})}function se(){q();const[i,R]=l.useState([]),[o,I]=l.useState([]),[h,O]=l.useState([]),[p,f]=l.useState(!0),[x,N]=l.useState(null),[d,v]=l.useState("all"),[a,C]=l.useState("ALL"),[g,L]=l.useState("");l.useEffect(()=>{b(),w()},[d,a]);const b=async()=>{try{const s=await D.get("/admin/users");O([{id:"all",email:"All Users",name:"All Users"},...s.data.users])}catch(s){console.error("Error fetching users:",s),j.error("Failed to load users")}},w=async()=>{try{f(!0);const s=await D.get("/admin/devices",{params:{status:a!=="ALL"?a:void 0,userId:d!=="all"?d:void 0}});console.log("Fetched devices:",s.data.devices),R(s.data.devices||[])}catch(s){console.error("Error fetching devices:",s),j.error("Failed to load devices")}finally{f(!1)}};l.useEffect(()=>{const s=g.toLowerCase(),n=i.filter(t=>t.name.toLowerCase().includes(s)||t.uniqueId.toLowerCase().includes(s)||t.userEmail&&t.userEmail.toLowerCase().includes(s));I(n)},[g,i]);const m=[{id:"summary",title:"Summary Reports",description:"Distance, speed, and time analytics",icon:E,color:"bg-primary-100 text-primary-600"},{id:"route",title:"Route Reports",description:"Visual route tracking on map",icon:S,color:"bg-success-100 text-success-600"},{id:"positions",title:"Position History",description:"Detailed GPS coordinate data",icon:k,color:"bg-warning-100 text-warning-600"}];return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"loading-spinner w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Device Reports"}),e.jsx("p",{className:"text-gray-600",children:"Generate comprehensive reports for all GPS devices across users"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filters"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(G,{className:"w-5 h-5 text-gray-600"}),e.jsx("select",{value:d,onChange:s=>v(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500",children:h.map(s=>e.jsx("option",{value:s.id,children:s.name||s.email},s.id))})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(U,{className:"w-5 h-5 text-gray-600"}),e.jsxs("select",{value:a,onChange:s=>C(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"ALL",children:"All Statuses"}),e.jsx("option",{value:"ONLINE",children:"Online"}),e.jsx("option",{value:"OFFLINE",children:"Offline"})]})]}),e.jsx("div",{className:"flex items-center space-x-4 flex-1",children:e.jsx("input",{type:"text",value:g,onChange:s=>L(s.target.value),placeholder:"Search by device name, ID, or user email",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm w-full focus:ring-primary-500 focus:border-primary-500"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:m.map(s=>{const n=s.icon;return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s.color}`,children:e.jsx(n,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]})},s.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Device for Reports"}),o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No devices available"}),e.jsx("p",{className:"text-gray-600",children:"No devices found for the selected filters"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-primary-300 hover:shadow-md transition-all cursor-pointer",onClick:()=>{console.log(`Opening reports for device ID: ${s.id}`),N({id:s.id,name:s.name,uniqueId:s.uniqueId,userEmail:s.userEmail,traccarId:s.traccarId,lastUpdate:s.lastUpdate,latitude:s.latitude,longitude:s.longitude,speed:s.speed,course:s.course,isActive:s.isActive,userId:s.userId||null})},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s.isOnline?"bg-success-100":"bg-gray-100"}`,children:e.jsx(U,{className:`w-5 h-5 ${s.isOnline?"text-success-600":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.uniqueId}),e.jsxs("p",{className:"text-sm text-gray-500",children:["User: ",s.userEmail||"Unassigned"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.isOnline?"bg-success-100 text-success-800":"bg-gray-100 text-gray-800"}`,children:s.isOnline?"Online":"Offline"}),s.lastUpdate&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.lastUpdate).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{className:"btn-primary w-full text-sm",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Generate Reports"]})})]},s.id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>{const s=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),t=document.createElement("a");t.href=n,t.download=`all_devices_${d==="all"?"all_users":d}_${a==="ALL"?"all_statuses":a}_${new Date().toISOString().split("T")[0]}.json`,t.click(),URL.revokeObjectURL(n),j.success("All device data exported")},className:"flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors",children:[e.jsx(A,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Export All Device Data"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Download data for filtered devices"})]})]}),e.jsxs("button",{className:"flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors",children:[e.jsx(k,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Schedule Reports"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Set up automated reporting"})]})]})]})]}),x&&e.jsx(H,{device:x,onClose:()=>N(null)})]})}export{se as default};
//# sourceMappingURL=AdminReports-utYfDRfk.js.map
