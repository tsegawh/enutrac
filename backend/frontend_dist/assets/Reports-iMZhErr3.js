import{r as i,b as N,z as v,j as e,B as b,M as p,e as G}from"./index-Dza2ow_d.js";import{D as q}from"./DeviceMap-Dj2W3kp8.js";import{X as z}from"./x-BPQG-vSi.js";import{C as w}from"./calendar-CDwTpDyp.js";import{R as k,G as T}from"./route-vEfv4Ayk.js";import{D as S}from"./download-CYelR1NA.js";import{C as $}from"./clock-Bia-aWg3.js";import{f as E}from"./index-CipiYhTN.js";import{S as L}from"./smartphone-BueILheT.js";function H({device:l,onClose:g}){var C,M;const[o,y]=i.useState("summary"),[n,u]=i.useState("today"),[m,j]=i.useState(""),[t,f]=i.useState(""),[F,D]=i.useState(!1),[r,A]=i.useState({summary:null,positions:[]});i.useEffect(()=>{U()},[n,m,t]);const P=()=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate());switch(n){case"today":return{from:a.toISOString(),to:s.toISOString()};case"7days":const c=new Date(a);return c.setDate(c.getDate()-7),{from:c.toISOString(),to:s.toISOString()};case"30days":const d=new Date(a);return d.setDate(d.getDate()-30),{from:d.toISOString(),to:s.toISOString()};case"custom":return{from:m?new Date(m).toISOString():a.toISOString(),to:t?new Date(t).toISOString():s.toISOString()};default:return{from:a.toISOString(),to:s.toISOString()}}},U=async()=>{if(l.id){D(!0);try{const{from:s,to:a}=P(),[c,d]=await Promise.all([N.get(`/device/${l.id}/reports`,{params:{from:s,to:a}}),N.get(`/device/${l.id}/positions`,{params:{from:s,to:a,limit:1e3}})]);A({summary:c.data.summary,positions:d.data.positions||[]})}catch(s){console.error("Error fetching reports:",s),v.error("Failed to load device reports")}finally{D(!1)}}},R=s=>{const a=s==="summary"?r.summary:r.positions,c=`${l.name}_${s}_${E(new Date,"yyyy-MM-dd")}.json`,d=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),I=URL.createObjectURL(d),h=document.createElement("a");h.href=I,h.download=c,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(I),v.success(`${s} data exported successfully`)},O=s=>{const a=Math.floor(s/60),c=Math.round(s%60);return a>0?`${a}h ${c}m`:`${c}m`},x=r.positions.map(s=>({latitude:s.latitude,longitude:s.longitude,speed:s.speed,timestamp:s.fixTime}));return console.log("Route data:",x),console.log("Report data positions:",r.positions),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Device Reports"}),e.jsxs("p",{className:"text-gray-600",children:[l.name," (",l.uniqueId,")"]})]}),e.jsx("button",{onClick:g,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(z,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Date Range:"})]}),e.jsx("div",{className:"flex space-x-2",children:[{value:"today",label:"Today"},{value:"7days",label:"7 Days"},{value:"30days",label:"30 Days"},{value:"custom",label:"Custom"}].map(s=>e.jsx("button",{onClick:()=>u(s.value),className:`px-3 py-1 text-sm rounded-lg transition-colors ${n===s.value?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-100"}`,children:s.label},s.value))}),n==="custom"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"datetime-local",value:m,onChange:s=>j(s.target.value),className:"px-2 py-1 text-sm border border-gray-300 rounded"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"datetime-local",value:t,onChange:s=>f(s.target.value),className:"px-2 py-1 text-sm border border-gray-300 rounded"})]})]})}),e.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"summary",label:"Summary",icon:b},{id:"route",label:"Route",icon:k},{id:"positions",label:"Positions",icon:p}].map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>y(s.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium transition-colors ${o===s.id?"border-b-2 border-primary-500 text-primary-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.id)})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{})}):e.jsxs(e.Fragment,{children:[o==="summary"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Report Summary"}),e.jsxs("button",{onClick:()=>R("summary"),className:"btn-secondary flex items-center space-x-2",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]}),r.summary?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Distance"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[r.summary.totalDistance.toFixed(2)," km"]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-success-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max Speed"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[Math.round(r.summary.maxSpeed)," km/h"]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-warning-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Speed"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[Math.round(r.summary.averageSpeed)," km/h"]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Time"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:O(r.summary.totalTime)})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Moving Time"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:O(r.summary.movingTime)})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(p,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Positions"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:r.summary.positionCount})]})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No data available for the selected period"})})]}),o==="route"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Route Visualization"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[x.length," position points"]})]}),x.length>0?e.jsx("div",{className:"h-96 w-full",children:e.jsx(q,{devices:[{id:l.id,name:l.name,uniqueId:l.uniqueId,latitude:((C=x[0])==null?void 0:C.latitude)||null,longitude:((M=x[0])==null?void 0:M.longitude)||null,speed:null,course:null,lastUpdate:null,isOnline:!1}],routeData:x,showRoute:!0})}):e.jsx("div",{className:"flex items-center justify-center h-96 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No route data available"})]})})]}),o==="positions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Position History"}),e.jsxs("button",{onClick:()=>R("positions"),className:"btn-secondary flex items-center space-x-2",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]}),r.positions.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Time"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Latitude"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Longitude"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Speed"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Course"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Altitude"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:r.positions.slice(0,100).map((s,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:E(new Date(s.fixTime),"MMM dd, HH:mm:ss")}),e.jsx("td",{className:"px-4 py-2 font-mono",children:s.latitude.toFixed(6)}),e.jsx("td",{className:"px-4 py-2 font-mono",children:s.longitude.toFixed(6)}),e.jsxs("td",{className:"px-4 py-2",children:[Math.round(s.speed)," km/h"]}),e.jsxs("td",{className:"px-4 py-2",children:[Math.round(s.course),"Â°"]}),e.jsxs("td",{className:"px-4 py-2",children:[Math.round(s.altitude),"m"]})]},a))})]}),r.positions.length>100&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Showing first 100 positions. Export for complete data."})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No position data available"})})]})]})})]})})}function Z(){const[l,g]=i.useState([]),[o,y]=i.useState(!0),[n,u]=i.useState(null);i.useEffect(()=>{m()},[]);const m=async()=>{try{const t=await N.get("/device");g(t.data.devices)}catch(t){console.error("Error fetching devices:",t),v.error("Failed to load devices")}finally{y(!1)}},j=[{id:"summary",title:"Summary Reports",description:"Distance, speed, and time analytics",icon:b,color:"bg-primary-100 text-primary-600"},{id:"route",title:"Route Reports",description:"Visual route tracking on map",icon:p,color:"bg-success-100 text-success-600"},{id:"positions",title:"Position History",description:"Detailed GPS coordinate data",icon:w,color:"bg-warning-100 text-warning-600"}];return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"loading-spinner w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Device Reports"}),e.jsx("p",{className:"text-gray-600",children:"Generate comprehensive reports for your GPS devices"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:j.map(t=>{const f=t.icon;return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t.color}`,children:e.jsx(f,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})]})},t.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Device for Reports"}),l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No devices available"}),e.jsx("p",{className:"text-gray-600",children:"Add devices to generate reports"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-primary-300 hover:shadow-md transition-all cursor-pointer",onClick:()=>u(t),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t.isOnline?"bg-success-100":"bg-gray-100"}`,children:e.jsx(L,{className:`w-5 h-5 ${t.isOnline?"text-success-600":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.uniqueId}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.isOnline?"bg-success-100 text-success-800":"bg-gray-100 text-gray-800"}`,children:t.isOnline?"Online":"Offline"}),t.lastUpdate&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.lastUpdate).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{className:"btn-primary w-full text-sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Generate Reports"]})})]},t.id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{className:"flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors",children:[e.jsx(S,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Export All Data"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Download complete device data"})]})]}),e.jsxs("button",{className:"flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors",children:[e.jsx(w,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Schedule Reports"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Set up automated reporting"})]})]})]})]}),n&&e.jsx(H,{device:n,onClose:()=>u(null)})]})}export{Z as default};
//# sourceMappingURL=Reports-iMZhErr3.js.map
